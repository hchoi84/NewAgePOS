@page "{saleid:min(1)}"
@model NewAgePOS.Pages.Sale.CheckoutModel
@{
  ViewData["Title"] = "Checkout";
  float subtotal = Model.SaleLines.Sum(sl => sl.LineTotal);
  float discount = Model.SaleLines.Sum(sl => (sl.Qty * sl.DiscAmt) + (sl.Qty * (sl.Price * sl.DiscPct / 100)));
  float tax = (subtotal - discount) * (Model.TaxPct / 100);
  float total = subtotal - discount + tax;
}

<h3 class="mt-5">PRODUCTS</h3>
@foreach (var saleLine in Model.SaleLines)
{
  float priceAfterDisc = (saleLine.Price - saleLine.DiscAmt) * (1 - saleLine.DiscPct / 100f);

  @if (saleLine != Model.SaleLines.First())
  {
    <div class="mt-3"></div>
  }

  <div class="row">
    <div class="col rounded border border-dark p-1 bg-dark m-1">
      @saleLine.AllName
    </div>
  </div>
  <div class="row">
    <div class="col rounded border border-dark p-1 bg-dark m-1">
      @if (saleLine.Price == priceAfterDisc)
      {
        @saleLine.Price.ToString("C2")
      }
      else
      {
        <span class="small"><s>@saleLine.Price.ToString("C2")</s></span>
        <span>@priceAfterDisc.ToString("C2")</span>
      }
    </div>
    <div class="col rounded border border-dark p-1 bg-dark m-1">
      @saleLine.Qty
    </div>
  </div>
}

<h3 class="mt-5">CUSTOMER INFO</h3>
@if (Model.Customer.EmailAddress == "guest@email.com")
{
  <h4>Guest Account</h4>
}
else
{
  <div class="row">
    <div class="col rounded border border-dark p-1 bg-dark m-1">
      @Model.Customer.FirstName
    </div>
    <div class="col rounded border border-dark p-1 bg-dark m-1">
      @Model.Customer.LastName
    </div>
  </div>
  <div class="row">
    <div class="col rounded border border-dark p-1 bg-dark m-1">
      @Model.Customer.EmailAddress
    </div>
    <div class="col rounded border border-dark p-1 bg-dark m-1">
      @Model.Customer.PhoneNumber
    </div>
  </div>
}

<h3 class="mt-5">PAYMENT</h3>
<form method="post">
  <div class="form-group col-md-4">
    <label asp-for="@Model.SaleTransaction.PaymentType"></label>
    <select asp-for="@Model.SaleTransaction.PaymentType" class="form-control">
      <option>Choose...</option>
      <option selected>Cash</option>
      <option>Credit Card</option>
    </select>
  </div>
  <div class="form-group col-md-2">
    <label asp-for="@Model.SaleTransaction.Amount"></label>
    <input asp-for="@Model.SaleTransaction.Amount" class="form-control">
  </div>
  <div class="form-group">
    <label asp-for="@Model.SaleTransaction.Message"></label>
    <textarea asp-for="@Model.SaleTransaction.Message" rows="2" class="form-control"></textarea>
  </div>
  <button type="submit" class="btn btn-primary">Complete</button>
</form>

<div class="mt-5" style="max-width: 400px;">
  <div class="row">
    <div class="col-4 h4">Subtotal</div>
    <div class="col-5 h4 text-right">@subtotal.ToString("C2")</div>
  </div>
  <div class="row">
    <div class="col-4 h4">Discount</div>
    <div class="col-5 h4 text-right">@discount.ToString("C2")</div>
  </div>
  <div class="row">
    <div class="col-4 h4">Tax @Model.TaxPct.ToString("P2")</div>
    <div class="col-5 h4 text-right">@tax.ToString("C2")</div>
  </div>
  <div class="row">
    <div class="col-4 h4">Total</div>
    <div class="col-5 h4 text-right">@total.ToString("C2")</div>
  </div>
</div>