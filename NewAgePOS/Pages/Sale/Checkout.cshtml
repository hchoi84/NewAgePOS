@page "{saleid:min(1)}"
@model NewAgePOS.Pages.Sale.CheckoutModel
@{
  ViewData["Title"] = "Checkout";
  CultureInfo dollar = new CultureInfo("en-US");
}

@if (TempData["Message"] != null)
{
  <div class="text-danger">@TempData["Message"]</div>
}

<h3 class="mt-5">PRODUCTS</h3>
@foreach (var saleLine in Model.SaleLines)
{
  float priceAfterDisc = saleLine.Price * (1 - saleLine.DiscPct / 100f);

  @if (saleLine != Model.SaleLines.First())
  {
    <div class="mt-3"></div>
  }

  <div class="row">
    <div class="col">
      <div class="border border-dark rounded bg-dark p-1">@saleLine.AllName</div>
    </div>
  </div>
  <div class="row">
    <div class="col pr-0">
      <div class="border border-dark rounded bg-dark p-1">
        @if (saleLine.Price == priceAfterDisc)
        {
          @saleLine.Price.ToString("C2", dollar)
        }
        else
        {
          <span class="small"><s>@saleLine.Price.ToString("C2", dollar)</s></span>
          <span>@priceAfterDisc.ToString("C2", dollar)</span>
        }
      </div>
    </div>
    <div class="col pl-0">
      <div class="border border-dark rounded bg-dark p-1">
        @saleLine.Qty
      </div>
    </div>
  </div>
}

<h3 class="mt-5">CUSTOMER INFO</h3>
@if (Model.Customer.EmailAddress == "guest@email.com")
{
  <h4>Guest Account</h4>
}
else
{
  <div class="form-row">
    <div class="col pr-0">
      <input readonly value="@Model.Customer.FirstName" class="form-control border-dark" />
    </div>
    <div class="col pl-0">
      <input readonly value="@Model.Customer.LastName" class="form-control border-dark" />
    </div>
  </div>
  <div class="form-row">
    <div class="col pr-0">
      <input readonly value="@Model.Customer.EmailAddress" class="form-control border-dark" />
    </div>
    <div class="col pl-0">
      <input readonly value="@Model.Customer.PhoneNumber" class="form-control border-dark" />
    </div>
  </div>
}

<h3 class="mt-5">PAYMENT</h3>
<form method="post">
  <div class="form-group">
    <label asp-for="@Model.Transaction.Method"></label>
    <select asp-for="@Model.Transaction.Method" class="form-control">
      <option>Choose...</option>
      <option selected>Cash</option>
      <option>Credit Card</option>
    </select>
  </div>
  <div class="form-group">
    <label asp-for="@Model.Transaction.Amount"></label>
    <input asp-for="@Model.Transaction.Amount" class="form-control">
  </div>
  <div class="form-group">
    <label asp-for="@Model.Transaction.Message"></label>
    <textarea asp-for="@Model.Transaction.Message" rows="2" class="form-control"></textarea>
  </div>
  <button type="submit" class="btn btn-success">Complete</button>
</form>

@await Component.InvokeAsync("SalePriceSummary", new { saleLines = Model.SaleLines, taxPct = Model.TaxPct })
